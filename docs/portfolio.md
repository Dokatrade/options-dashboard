# Portfolio — концепция обновления

## Общая идея
- Перевести раздел в режим "портфель как дашборд": агрегаты по рискам, греклам, P/L, марже.
- Сделать интерактивные ссылки на Options Dashboard для каждого тикера/стратегии.
- Ввести индикаторы состояния (лимиты, концентрация, сроки) с подсказками и действиями.
- Расширить таблицу позиций: группировка по стратегиям, break-even, expirations, быстрый переход в детализацию.
- Добавить мини-сценарный анализ (слайдеры цены/IV) с пересчетом агрегированных показателей портфеля.
- Вынести инструменты (backup, пресеты фильтров, экспорт) в отдельный блок Portfolio Tools.

## План реализации
1. **Прояснить требования**: список KPI, сценарии перехода, критерии сигналов, связи с текущими данными Dashboard.
2. **Проектирование UX/UI**: вайрфрейм нового Portfolio (агрегаты, Alerts, таблица, фильтры, tools), согласование навигации.
3. **Работа со стором**: расширить типы и селекторы (греки, маржа, P/L, alerts), настроить синхронизацию фильтров с Dashboard.
4. **Базовые компоненты**: декомпозировать `PortfolioSummary` на `PortfolioStats`, `PortfolioAlerts`, `PortfolioTable`, `PortfolioTools` и связать со стором.
5. **Интеграция с Options Dashboard**: маршруты и линкование, общие фильтры и пресеты.
6. **Сценарный анализ**: контролы чувствительности (цена, волатильность), кеширование результатов.
7. **Таблица позиций**: группировка по стратегиям, расчеты break-even, сортировки, подсветка критичных позиций.
8. **Alerts & Health**: правила на лимиты, концентрацию и expirations, визуальные статусы, подсказки.
9. **Portfolio Tools**: backup/export, пресеты фильтров, CSV/PDF, обновление справки.
10. **Валидация**: тесты селекторов и сигналов, ручная проверка сценариев, документация и чек-лист регрессии.

## Детализированный backlog
### Data & Store
- Собрать полный список полей из `src/store/store.ts`, `src/utils/types.ts`, выяснить, какие данные доступны от Options Dashboard (через сервисы или API).
- Добавить в типы `PortfolioSettings` новые параметры: лимиты по грейкам, максимальный размер позиции на тикер, настройки сигналов.
- Реализовать агрегирующие селекторы: суммарные греки (Delta, Gamma, Theta, Vega) по портфелю/тикеру/стратегии; маржинальные требования; MaxLoss/MaxGain; реализованный и нереализованный P/L.
- Настроить селектор концентрации (доля по тикеру и по стратегии) с порогами для сигналов.
- Обновить импорт/экспорт JSON (DataBackup) для сохранения новых полей и пресетов фильтров.

### Components & UI
- Разбить `PortfolioSummary` на подкомпоненты: `PortfolioStats` (агрегаты), `PortfolioAlerts` (индикаторы), `PortfolioScenario` (контролы чувствительности), `PortfolioTable` (позиции), `PortfolioTools`.
- Подготовить UI-компоненты для отображения KPI: карточки со значениями, мини-чарты для P/L и экспозиций, индикаторы состояния (иконки, цветовые статусы).
- Реализовать таблицу с поддержкой группировки по стратегии/тикеру, сортировок, раскрытия деталей и кнопки "Открыть в Dashboard".
- Добавить контролы фильтров: выбор символов, типов стратегий, диапазона expiration; двойная синхронизация с Dashboard.
- Реализовать сценарный блок: слайдер цены базового актива, шаги IV; отображать пересчитанные агрегаты и изменения в процентах.

### Alerts & Health
- Определить правила сигналов: превышение MaxLoss/Deposit, концентрация > X%, отсутствие хеджей, позиции с экспирацией < N дней.
- Настроить отображение карточек-сигналов: уровень (info/warn/critical), текст подсказки, CTA (перейти в Dashboard, закрыть позицию, увеличить депозит).
- Учесть режим "без сигналов" при отсутствии данных или если пользователь отключил уведомления.

### Integration & Navigation
- Настроить общий объект фильтров (Context или Zustand store) для Portfolio и Dashboard, с сохранением пресетов.
- Обновить роутинг/линки: переходы из таблицы и карточек к нужным состояниям Dashboard с передачей фильтров.
- Рассмотреть обратные переходы (из Dashboard в Portfolio) для возврата к сводке с теми же фильтрами.

### Documentation & Support
- Расширить `HelpModal` и `docs/` описанием новых возможностей портфеля и сигналов.
- Подготовить раздел FAQ по сценарному анализу и сохранению пресетов.

## Стартовые шаги
- Провести ревью стора (`src/store/store.ts`) и утилит; составить таблицу текущих метрик vs необходимых.
- Подготовить быстрый макет (sketch/figma) с расположением агрегатов, Alerts, таблицы и переходов.
- После согласования макета сформировать backlog задач по данным, компонентам и интеграции Dashboard с оценками.

## Черновой вайрфрейм (текстовое описание)
- **Шапка**: название Portfolio, текущая дата/время, кнопка быстрого экспорта.
- **Блок KPI (в 2 строки)**: карточки Delta/Gamma/Theta/Vega, MaxLoss/MaxGain, Margin Impact, P/L (дневной и общий). Цветовое кодирование состояний.
- **Alerts & Health**: горизонтальная лента карточек-сигналов; клик открывает popover с действиями.
- **Scenario Controls**: небольшая панель с слайдерами цены (+/- %), волатильности (IV shift), чекбоксами режима (spot/expiration). Ниже показываем дельту изменений по ключевым метрикам.
- **Фильтры**: символы, стратегии, expiration range, чекбокс "только открытые"; сохраняемые пресеты (dropdown).
- **Таблица позиций**: слева — сгруппированный список (тикер > стратегия > позиция), справа — ключевые метрики (Qty, Entry, Mid, P/L, BreakEven, Expiration, Risk). В строках иконка для перехода в Dashboard.
- **Portfolio Tools**: блок внизу с кнопками Export/Import, Manage Presets, Download CSV/PDF, ссылка на документацию.
- **Доп. информация**: заметки пользователя или checklist по управлению портфелем.

## Зависимости и риски
- Требуется подтверждение доступности данных для расчета греков и маржи; если их нет, нужна интеграция с источником.
- Производительность: пересчет агрегатов и сценариев может быть тяжелым; нужен план по мемоизации и lazy-loading.
- UX-риски: переизбыток информации; необходимо тестирование прототипа с реальными пользователями/кейсами.
